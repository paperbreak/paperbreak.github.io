[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "PaperBreak",
    "section": "",
    "text": "Breaking the Softmax Bottleneck\n\n\n\n\n\n\ntheory\n\n\nlanguage modeling\n\n\n\n\n\n\n\n\n\nFeb 18, 2025\n\n\nC.H.\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/softmax-bottleneck/index.html",
    "href": "posts/softmax-bottleneck/index.html",
    "title": "Breaking the Softmax Bottleneck",
    "section": "",
    "text": "A breakdown of the theoretical portion of the paper Breaking the Softmax Bottleneck: A High-Rank RNN Language Model"
  },
  {
    "objectID": "posts/softmax-bottleneck/index.html#definitions",
    "href": "posts/softmax-bottleneck/index.html#definitions",
    "title": "Breaking the Softmax Bottleneck",
    "section": "Definitions",
    "text": "Definitions\n\nLet \\(A = \\log \\mathbb{P}^*(X \\vert C)\\)\n\nNote: here we use the notation \\(\\mathbb{P}^*\\) to denote the true distribution. In practice, we donâ€™t know what the true distribution is - we are trying to solve for it.\n\nLet \\(F(A)\\) be the set of row-wise shifts of the matrix \\(A\\):\n\n\\[\n\\begin{align}\nF(A) & = \\{ A + C \\space \\vert \\space C_{i,:} = c, c \\in \\mathbb{R}  \\} & (1) \\\\\n& = \\{ A + \\Lambda J_{m,n} \\space \\vert \\space \\Lambda \\text{ is diagonal}, \\Lambda \\in \\mathbb{R}^{n \\times n} \\} & (2)\n\\end{align}\n\\]\nAt first glance, the set \\(F(A)\\) might seem very unnatural - but it essentially just represents the idea that Softmax is shift-invariant: \\[\n\\text{Softmax}(\\vec x) = \\frac{\\exp(\\vec x)}{\\sum_j \\exp(x_j)}\n\\] If we shift each element of \\(\\vec x\\) by the same value \\(c\\), formally \\(\\vec x + \\vec c\\) where \\(\\vec c = [c, c, \\dots, c]\\), then \\(\\text{Softmax}(\\vec x + \\vec c) = \\text{Softmax}(\\vec x)\\). \\(F(A)\\) is just the matrix form of this idea.\nNote: I wrote two equivalent definitions for \\(A\\) for (1) and (2) - definition (1) is easier to understand, and definition (2) is more useful for one of our proofs later."
  },
  {
    "objectID": "posts/softmax-bottleneck/index.html#properties",
    "href": "posts/softmax-bottleneck/index.html#properties",
    "title": "Breaking the Softmax Bottleneck",
    "section": "Properties",
    "text": "Properties\n\nProperty 1\nFor any matrix \\(A'\\), \\(A' \\in F(A) \\iff \\text{Softmax}(A') = \\mathbb{P}^*(X \\vert C)\\)\nThe set \\(F(A)\\) defines the set of all logits that correspond to the true probability distribution \\(\\mathbb{P}^*\\). This means our logits \\(H_\\theta W_\\theta^\\top\\) have to be in the set \\(F(A)\\) for our NN to be able to approximate the true distribution \\(\\mathbb{P}^*\\).\n\\(\\implies\\)\n\\[\n\\begin{aligned}\n& & A' &\\in F(A) & (1) \\\\\n\\implies & & A' &= A + C & (2) \\\\\n\\implies & & \\text{Softmax}(A') &= \\text{Softmax}(A + C) & (3) \\\\\n& & &= \\text{Softmax}(A) & (4) \\\\\n& & &= \\text{Softmax}(\\log \\mathbb{P}^*(X \\vert C)) & (5) \\\\\n& & &= \\mathbb{P}^*(X \\vert C) \\quad \\blacksquare & (6)\n\\end{aligned}\n\\]\nNote: Softmax is shift-invariant (line 3)\n\\(\\impliedby\\)\n\\[\n\\begin{aligned}\n& & \\text{Softmax}(A') &= \\mathbb{P}^*(X \\vert C) & (1) \\\\\n\\implies & & \\log \\text{Softmax}(A') &= \\log \\mathbb{P}^*(X \\vert C) & (2) \\\\\n\\implies & & \\log \\text{Softmax}(A') &= A & (3) \\\\\n\\implies & & A' + \\log \\Sigma \\exp(A') &= A & (4) \\\\\n\\implies & & A' &= A - \\log \\Sigma \\exp(A') & (5) \\\\\n& & & \\in \\space F(A)  \\quad \\blacksquare & (6)\n\\end{aligned}\n\\]\nNote: Line (4) above is abuse of notation, specifically the \\(\\Sigma \\exp(A')\\). This sum is applied row-wise.\n\n\nLemma 1\nIt follows immediately from property 1 that given model parameters \\(\\theta\\)\n\\[\nH_\\theta W_\\theta^\\top \\in F(A) \\iff \\mathbb{P}_\\theta(X \\vert C) = \\mathbb{P}^*(X \\vert C)\n\\]\n\n\nProperty 2\n\\(\\forall A_1 \\neq A_2 \\in F(A), \\vert \\text{rank}(A_1) - \\text{rank}(A_2) \\vert \\leq 1\\)\nThis is saying that all matrices that belong to the set \\(F(A)\\) have a similar rank. This is not surprising - every matrix in \\(F(A)\\) is simply row-wise shifted by some constant factor.\n\\(\\implies\\)\n\\[\n\\begin{aligned}\n& & \\text{Given } A_1 \\neq A_2 &\\in F(A) & (1) \\\\\n& & A_1 &= A + \\Lambda_1 \\mathbb{J}_{m,n} & (2) \\\\\n& & A_2 &= A + \\Lambda_2 \\mathbb{J}_{m,n} & (3) \\\\\n\\implies & & A_1 &= A_2 + (\\Lambda_1 - \\Lambda_2)\\mathbb{J}_{m,n} & (4) \\\\\n\\implies & & \\text{rank}(A_1) &= \\text{rank}(A_2 + (\\Lambda_1 - \\Lambda_2)\\mathbb{J}_{m,n}) & (5) \\\\\n& & &\\leq \\text{rank}(A_2) + \\text{rank}((\\Lambda_1 - \\Lambda_2)\\mathbb{J}_{m,n}) & (6) \\\\\n& & &\\leq \\text{rank}(A_2) + \\min(\\text{rank}(\\Lambda_1 - \\Lambda_2),\\text{rank}(\\mathbb{J}_{m,n})) & (7) \\\\\n& & &\\leq \\text{rank}(A_2) + 1 & (8) \\\\\n& & \\text{similarly, we can find that} & & \\\\\n& & \\text{rank}(A_2) &\\leq \\text{rank}(A_1) - 1 & (9) \\\\\n\\implies & & \\vert \\text{rank}(A_1) - \\text{rank}(A_2) \\vert &\\leq 1 \\quad \\blacksquare & (10)\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "posts/softmax-bottleneck/index.html#the-softmax-bottleneck",
    "href": "posts/softmax-bottleneck/index.html#the-softmax-bottleneck",
    "title": "Breaking the Softmax Bottleneck",
    "section": "The Softmax Bottleneck",
    "text": "The Softmax Bottleneck\nWe can now combine the properties above to prove the existance of the softmax bottleneck:\n\nProposition 1\n\\[\n\\exists \\space \\theta \\ni \\mathbb{P}_\\theta(X|C) = \\mathbb{P}^*(X|C) \\iff d \\geq \\min_{A' \\in F(A)}\\text{rank}(A')\n\\]\n\\(\\implies\\)\n\\[\n\\begin{aligned}\n& & \\exists \\space \\theta \\ni \\mathbb{P}_\\theta(X|C) &= \\mathbb{P}^*(X|C) & (1) \\\\\n\\underset{\\tiny\\text{Lemma 1}}{\\implies} & & H_\\theta W_\\theta^\\top &\\in F(A) & (2) \\\\\n\\implies & & \\exists A' \\in F(A) \\ni H_\\theta W_\\theta^\\top &= A' & (3) \\\\\n\\implies & & \\text{rank}(H_\\theta W_\\theta^\\top) &= \\text{rank}(A') & (4) \\\\\n\\implies & & d &= \\text{rank}(A') & (5) \\\\\n& & &\\geq \\min_{A'' \\in F(A)} \\text{rank}(A'') \\quad \\blacksquare & (6)\n\\end{aligned}\n\\]\n\\(\\impliedby\\)\n\\[\n\\begin{aligned}\n& & d \\geq \\min_{A'' \\in F(A)} &\\text{rank}(A'') & & (1) \\\\\n&\\implies & \\exists A' &\\in F(A) & & (2a) \\\\\n& & \\exists H' &\\in \\mathbb{R}^{n \\times d} & & (2b) \\\\\n& & \\exists W' &\\in \\mathbb{R}^{m \\times d} & & (2c) \\\\\n& & A' &= H'W' & & (2d) \\\\\n&\\underset{\\tiny\\text{Univ. A.T.}}{\\implies} & \\exists \\space \\theta \\ni H' &= H_\\theta & & (3a) \\\\\n& & W' &= W_\\theta & & (3b) \\\\\n&\\underset{\\tiny\\text{Lemma 1}}{\\implies} & \\mathbb{P}_\\theta(X|C) &= \\mathbb{P}^*(X|C) & & (4)\n\\end{aligned}\n\\]\n\n\nCorollary 1\nThe Softmax Bottleneck:\n\\[\nd &lt; \\text{rank}(A) - 1 \\implies \\forall \\theta \\space  \\exists c \\in C \\ni \\mathbb{P}_\\theta(X|c) \\neq \\mathbb{P}^*(X|c)\n\\]\n\\(\\implies\\)\n\\[\n\\begin{aligned}\n& & d &&lt; \\text{rank}(A) - 1 & & (1) \\\\\n&\\underset{\\tiny\\text{Property 2}}{\\implies} & H_\\theta W_\\theta^\\top &\\notin F(A) & & (2) \\\\\n&\\underset{\\tiny\\text{Proposition 1}}{\\implies} & \\forall \\theta \\space \\exists c \\in C \\ni \\mathbb{P}_\\theta(X|c) &\\neq \\mathbb{P}^*(X|c) & & (3)\n\\end{aligned}\n\\]"
  }
]